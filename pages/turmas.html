<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Observatório da Evasão</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
  
  <style>
    body {
      background-color: #F4F6F8;
      color: black;
    }

    .text-white {
      background-color: #25A667;
      color: white;
    }

    .bg-green {
      background-color: #25A667;
    }

    .highlight {
      background-color: white;
      border-radius: 200;
      margin-top: 2rem;
    }

    section {
      height: 70%;
    }

    .login {
      width: 30%;
      margin-top: 5%;
    }

    .botao:hover {
      background-color: #0fe980;
    }

    .result {
      margin-top: 1rem;
      padding: 0.5rem;
    }

    .curso-item {
      background-color: #F3B713;
      border: 1px solid #dee2e6;
      border-radius: 5px;
      padding: 10px 15px;
      font-size: 1rem;
      color: #212529;
      text-decoration: none;
      transition: all 0.2s ease-in-out;
    }

    .curso-item:hover {
      background-color: #f5ce62;
      border-color: #ced4da;
      transform: translateX(5px);
      text-decoration: none;
      color: rgb(37, 34, 34);
    }

    .navbar {
      background-color: #25A667;
    }

    .navbar .navbar-brand h4 {
      margin: 0;
      margin-left: 10px;
    }

    .sidebar {
      background-color: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      min-width: 250px;
      max-width: 300px;
      margin-left: 30px;
      max-height: 45rem;
      overflow-y: auto;
    }

    .sidebar h5 {
      margin-bottom: 20px;
      font-weight: bold;
    }

    .pesquisa input {
      width: 100%;
      padding: 8px;
      border-radius: 4px;
      border: 1px solid #ccc;
    }

    .result {
      margin-top: 15px;
      min-height: 100px;
    }

    #legenda-areas {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 1rem;
      justify-content: center;
    }

    .legenda-item {
      display: flex;
      align-items: center;
      font-size: 0.9rem;
      gap: 0.5rem;
      background-color: #f8f9fa;
      padding: 8px 12px;
      border-radius: 6px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      border: 1px solid #e9ecef;
    }

    .legenda-cor {
      display: inline-block;
      width: 16px;
      height: 16px;
      border-radius: 3px;
      border: 1px solid rgba(0, 0, 0, 0.1);
    }

    .sidebar::-webkit-scrollbar {
      width: 6px;
    }

    .sidebar::-webkit-scrollbar-thumb {
      background-color: #ccc;
      border-radius: 4px;
    }

    .chart-container {
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
  </style>
</head>

<body>
  <header>
    <nav class="navbar navbar-expand-lg navbar-dark">
      <div class="container-fluid d-flex justify-content-between align-items-center">
        <a class="navbar-brand d-flex align-items-center" href="#">
          <img src="image 2.png" width="50" alt="Logo" />
          <h4 class="text-white ms-2">Observatório da Evasão</h4>
        </a>

        <div class="d-flex align-items-center gap-3 text-white">
          <p class="mb-0">Iuri Guilherme dos Santos</p>
          <a href="login.html" class="text-decoration-none">
            <button class="btn btn-light">Sair</button>
          </a>
        </div>
      </div>
    </nav>
  </header>

  <div class="d-flex align-items-center mt-4 justify-content-around">
    <div class="d-flex align-items-center">
      <h5 class="mb-0">Centro:</h5>
      <select class="form-select ms-2" style="width: auto;">
        <option value="universidade">Universidade</option>
        <option value="faculdade">CT</option>
        <option value="instituto">CSSH</option>
        <option value="escola">Politécnico</option>
      </select>
    </div>
  </div>
  
  <section class="container my-5 d-flex flex-wrap justify-content-between align-items-start">
    <div class="flex-grow-1 mb-4 me-4">
      <div class="chart-container">
        <canvas id="myChart" width="600" height="500"></canvas>
        
        <!-- Legenda das Áreas -->
        <div id="legenda-areas">
          <div class="legenda-item">
            <span class="legenda-cor" style="background-color: #25A667;"></span>
            <span>Ciências da Saúde</span>
          </div>
          <div class="legenda-item">
            <span class="legenda-cor" style="background-color: #007bff;"></span>
            <span>Ciências Exatas</span>
          </div>
          <div class="legenda-item">
            <span class="legenda-cor" style="background-color: #6f42c1;"></span>
            <span>Ciências Humanas</span>
          </div>
          <div class="legenda-item">
            <span class="legenda-cor" style="background-color: #fd7e14;"></span>
            <span>Ciências Sociais</span>
          </div>
          <div class="legenda-item">
            <span class="legenda-cor" style="background-color: #dc3545;"></span>
            <span>Comunicação</span>
          </div>
          <div class="legenda-item">
            <span class="legenda-cor" style="background-color: #adb5bd;"></span>
            <span>Outras Áreas</span>
          </div>
        </div>
      </div>
    </div>

    <div class="sidebar">
      <div class="teste text-center">
        <h5>Cursos</h5>
        <div class="pesquisa mb-3">
          <input type="text" id="inputPesquisa" placeholder="Pesquisar curso...">
        </div>
        <div class="result">
          
        </div>
      </div>
    </div>
  </section>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const ctx = document.getElementById('myChart').getContext('2d');

    // Dados de exemplo para demonstração
    const exemploAlunos = [
      { curso: 'Engenharia Civil', probabilidade_evasao: 0.7 },
      { curso: 'Medicina', probabilidade_evasao: 0.3 },
      { curso: 'Enfermagem', probabilidade_evasao: 0.6 },
      { curso: 'Direito', probabilidade_evasao: 0.8 },
      { curso: 'Administração', probabilidade_evasao: 0.5 },
      { curso: 'Jornalismo', probabilidade_evasao: 0.9 },
      { curso: 'Matemática', probabilidade_evasao: 0.4 },
      { curso: 'Filosofia', probabilidade_evasao: 0.7 },
      { curso: 'Biologia', probabilidade_evasao: 0.6 },
      { curso: 'Economia', probabilidade_evasao: 0.8 }
    ];

    async function alunos() {
      // Simula carregamento de dados
      return new Promise(resolve => {
        setTimeout(() => resolve(exemploAlunos), 100);
      });
    }

    function contarAlunosComAltaEvasao(data) {
      const evasaoPorCurso = {};

      data.forEach(aluno => {
        if (aluno.probabilidade_evasao > 0.5) {
          const curso = aluno.curso;
          if (!evasaoPorCurso[curso]) {
            evasaoPorCurso[curso] = 0;
          }
          evasaoPorCurso[curso]++;
        }
      });

      const cursos = Object.keys(evasaoPorCurso);
      const quantidades = cursos.map(curso => evasaoPorCurso[curso]);

      return { cursos, quantidades };
    }

    async function createChart() {
      const data = await alunos();
      const { cursos, quantidades } = contarAlunosComAltaEvasao(data);

      // Ordena do maior pro menor
      const dadosOrdenados = cursos.map((curso, i) => ({
        curso,
        quantidade: quantidades[i]
      })).sort((a, b) => b.quantidade - a.quantidade);

      const cursosOrdenados = dadosOrdenados.map(d => d.curso);
      const quantidadesOrdenadas = dadosOrdenados.map(d => d.quantidade);

      const coresPorCurso = cursosOrdenados.map(curso => {
        const nome = curso.toLowerCase();

        if (nome.includes('enfermagem') || nome.includes('biologia') || nome.includes('química') || nome.includes('medicina')) return '#25A667'; // saúde
        if (nome.includes('engenharia') || nome.includes('matemática') || nome.includes('física') || nome.includes('computação')) return '#007bff'; // exatas
        if (nome.includes('direito') || nome.includes('filosofia') || nome.includes('artes') || nome.includes('letras')) return '#6f42c1'; // humanas
        if (nome.includes('contabilidade') || nome.includes('admin') || nome.includes('economia')) return '#fd7e14'; // sociais
        if (nome.includes('jornalismo') || nome.includes('publicidade')) return '#dc3545'; // comunicação
        return '#adb5bd'; // cinza padrão
      });

      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: cursosOrdenados,
          datasets: [{
            label: 'Alunos com risco de evasão',
            data: quantidadesOrdenadas,
            backgroundColor: coresPorCurso,
            borderColor: '#343a40',
            borderWidth: 1
          }]
        },
        options: {
          indexAxis: 'y',
          responsive: true,
          plugins: {
            tooltip: {
              callbacks: {
                title: function(context) {
                  return context[0].label;
                }
              }
            },
            legend: {
              display: false // Removemos a legenda padrão do Chart.js
            }
          },
          scales: {
            x: {
              beginAtZero: true,
              title: {
                display: true,
                text: 'Quantidade de Alunos'
              },
              ticks: {
                precision: 0
              }
            },
            y: {
              title: {
                display: true,
                text: 'Cursos'
              },
              ticks: {
                font: {
                  size: 12
                }
              }
            }
          }
        }
      });
    }

    let cursosData = [];

    async function carregarCursos() {
      const alunosData = await alunos();
      const cursosSet = new Set(alunosData.map(a => a.curso));
      cursosData = Array.from(cursosSet).sort();
    }

    function filtrarCursos(textoDigitado) {
      const container = document.querySelector('.result');
      container.innerHTML = '';

      const resultado = cursosData.filter(curso =>
        curso.toLowerCase().includes(textoDigitado.toLowerCase())
      );

      if (resultado.length === 0) {
        container.innerHTML = '<p>Nenhum curso encontrado.</p>';
        return;
      }

      resultado.forEach(curso => {
        const linkCurso = document.createElement('a');
        linkCurso.classList.add('curso-item', 'mb-2', 'd-block');
        linkCurso.textContent = curso;
        linkCurso.href = `cursos.html?nome=${encodeURIComponent(curso)}`;
        container.appendChild(linkCurso);
      });
    }

    document.addEventListener('DOMContentLoaded', async () => {
      await carregarCursos();
      createChart();

      const inputPesquisa = document.getElementById('inputPesquisa');
      
      filtrarCursos('');
      inputPesquisa.addEventListener('input', (e) => {
        filtrarCursos(e.target.value);
      });
    });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js" integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO" crossorigin="anonymous"></script>
</body>
</html>